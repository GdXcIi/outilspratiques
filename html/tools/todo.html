<!DOCTYPE html>
<div class="tool-container" id="todoTool">
    <link rel="stylesheet" href="../../styles/tools/todo.css">
    <div class="tool-header">
        <h2><i class="fas fa-tasks"></i> Tâches</h2>
        <div class="tool-actions">
            <button type="button" class="btn-icon" id="todoSearch" aria-label="Rechercher">
                <i class="fas fa-search"></i>
            </button>
            <button type="button" class="btn-icon" id="todoHelp" aria-label="Aide">
                <i class="fas fa-question-circle"></i>
            </button>
            <button type="button" class="btn-icon fullscreen-btn" id="todoFullscreenBtn" aria-label="Plein écran">
                <i class="fas fa-expand"></i>
            </button>
        </div>
    </div>
    
    <div class="tool-content">
        <div class="todo-horizontal-layout" id="todoContainer">
            <div class="todo-sidebar">
                <div class="todo-header">
                    <h3>Catégories</h3>
                    <button type="button" class="btn-icon" id="addNewList" aria-label="Nouvelle liste">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div class="todo-lists" id="listsContainer">
                    <div class="list-item active" data-list-id="default">
                        <i class="fas fa-list"></i>
                        <span>Tâches</span>
                        <span class="list-count">0</span>
                    </div>
                    <div class="list-item" data-list-id="today">
                        <i class="fas fa-calendar-day"></i>
                        <span>Aujourd'hui</span>
                        <span class="list-count">0</span>
                    </div>
                    <div class="list-item" data-list-id="important">
                        <i class="fas fa-star"></i>
                        <span>Important</span>
                        <span class="list-count">0</span>
                    </div>
                    <div class="list-item" data-list-id="completed">
                        <i class="fas fa-check-circle"></i>
                        <span>Terminé</span>
                        <span class="list-count">0</span>
                    </div>
                    <!-- Les listes personnalisées seront ajoutées ici -->
                </div>
                
                <div class="todo-sidebar-actions">
                    <button type="button" class="btn btn-outline" id="exportAllLists">
                        <i class="fas fa-download"></i> Exporter
                    </button>
                    <button type="button" class="btn btn-outline" id="importLists">
                        <i class="fas fa-upload"></i> Importer
                    </button>
                </div>
            </div>
            
            <div class="todo-main">
                <div class="todo-main-header">
                    <h3 id="currentListTitle">Tâches</h3>
                    <div class="todo-actions">
                        <div class="search-container">
                            <input type="text" id="searchTasks" placeholder="Rechercher des tâches..." class="search-input">
                        </div>
                        <div class="todo-filter">
                            <select id="todoFilter" class="form-select">
                                <option value="all">Toutes</option>
                                <option value="active">Actives</option>
                                <option value="completed">Terminées</option>
                            </select>
                        </div>
                        <div class="todo-sort">
                            <select id="todoSort" class="form-select">
                                <option value="added">Date d'ajout</option>
                                <option value="due">Date d'échéance</option>
                                <option value="priority">Priorité</option>
                                <option value="alphabetical">Alphabétique</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="todo-add-container">
                    <form id="addTodoForm">
                        <div class="todo-input-group">
                            <input type="text" id="newTodoInput" placeholder="Ajouter une tâche..." class="todo-input" required>
                            <div class="todo-quick-actions">
                                <button type="button" class="btn-icon" id="quickPriority" aria-label="Définir la priorité">
                                    <i class="fas fa-flag"></i>
                                </button>
                                <button type="button" class="btn-icon" id="quickDate" aria-label="Définir la date">
                                    <i class="fas fa-calendar-alt"></i>
                                </button>
                                <button type="submit" class="btn-icon add-todo" aria-label="Ajouter la tâche">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <!-- Menu de priorité rapide -->
                            <div class="quick-priority-menu" id="quickPriorityMenu">
                                <button type="button" class="quick-priority-option" data-priority="high">
                                    <i class="fas fa-flag" style="color: #fa5252;"></i> Élevée
                                </button>
                                <button type="button" class="quick-priority-option" data-priority="medium">
                                    <i class="fas fa-flag" style="color: #fab005;"></i> Moyenne
                                </button>
                                <button type="button" class="quick-priority-option" data-priority="low">
                                    <i class="fas fa-flag" style="color: #40c057;"></i> Faible
                                </button>
                            </div>
                            <!-- Menu de date rapide -->
                            <div class="quick-date-menu" id="quickDateMenu">
                                <button type="button" class="quick-date-option" data-date="today">
                                    Aujourd'hui
                                </button>
                                <button type="button" class="quick-date-option" data-date="tomorrow">
                                    Demain
                                </button>
                                <button type="button" class="quick-date-option" data-date="next-week">
                                    Semaine prochaine
                                </button>
                                <div class="quick-date-custom">
                                    <input type="date" id="quickDateCustom" class="form-input">
                                    <button type="button" id="applyCustomDate" class="btn btn-sm btn-primary">
                                        Appliquer
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="todo-list-container">
                    <div class="todo-list" id="todoList">
                        <!-- Liste des tâches générée dynamiquement -->
                    </div>
                </div>
                
                <div class="todo-summary">
                    <div class="todo-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="todoProgress" style="width: 0%"></div>
                        </div>
                        <div class="progress-text">
                            <span id="completedCount">0</span> sur <span id="totalCount">0</span> tâches terminées
                        </div>
                    </div>
                    <div class="todo-actions">
                        <button type="button" class="btn btn-sm" id="clearCompletedTasks">
                            <i class="fas fa-trash-alt"></i> Supprimer les tâches terminées
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Section de détails qui sera toujours visible sur grands écrans -->
            <div class="todo-details" id="todoDetails">
                <div class="details-header">
                    <h3>Détails de la tâche</h3>
                    <button type="button" class="btn-icon" id="closeTodoDetails">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="details-content">
                    <div class="details-title">
                        <input type="text" id="detailsTitle" placeholder="Titre de la tâche" class="details-input">
                    </div>
                    
                    <div class="details-group">
                        <label for="detailsPriority">Priorité</label>
                        <div class="priority-selector">
                            <button class="priority-btn" data-priority="low" id="priorityLow">Faible</button>
                            <button class="priority-btn" data-priority="medium" id="priorityMedium">Moyenne</button>
                            <button class="priority-btn" data-priority="high" id="priorityHigh">Élevée</button>
                            <input type="hidden" id="detailsPriority" value="medium">
                        </div>
                    </div>
                    
                    <div class="details-group">
                        <label for="detailsDueDate">Date d'échéance</label>
                        <input type="date" id="detailsDueDate" class="form-input">
                    </div>
                    
                    <div class="details-group">
                        <label for="detailsNotes">Notes</label>
                        <textarea id="detailsNotes" placeholder="Ajouter des notes..." class="details-textarea"></textarea>
                    </div>
                    
                    <div class="details-group">
                        <div class="details-label-inline">
                            <input type="checkbox" id="detailsReminder" class="checkbox-input">
                            <label for="detailsReminder">Ajouter un rappel</label>
                        </div>
                        <div class="reminder-options" id="reminderOptions">
                            <input type="datetime-local" id="reminderDateTime" class="form-input">
                        </div>
                    </div>
                    
                    <div class="details-group">
                        <label>Sous-tâches</label>
                        <div class="subtasks-container">
                            <div class="subtask-add">
                                <input type="text" id="newSubtask" placeholder="Ajouter une sous-tâche..." class="form-input">
                                <button type="button" class="btn-icon" id="addSubtask">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <div class="subtasks-list" id="subtasksList">
                                <!-- Les sous-tâches seront ajoutées ici -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="details-group">
                        <label for="detailsTag">Tags</label>
                        <div class="tag-input-container">
                            <input type="text" id="detailsTag" placeholder="Ajouter un tag..." class="form-input">
                            <button type="button" class="btn-icon" id="addTag">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="tags-list" id="tagsList">
                            <!-- Les tags seront ajoutés ici -->
                        </div>
                    </div>
                </div>
                
                <div class="details-footer">
                    <div class="details-info">
                        <p>Créée le <span id="createDate">--/--/----</span></p>
                    </div>
                    <div class="details-actions">
                        <button type="button" class="btn btn-danger" id="deleteTodo">
                            <i class="fas fa-trash-alt"></i> Supprimer
                        </button>
                        <button type="button" class="btn btn-primary" id="saveTodoDetails">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modale pour ajouter/modifier une liste -->
        <div class="modal" id="listModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="listModalTitle">Nouvelle liste</h3>
                    <button type="button" class="btn-icon" id="closeListModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="listForm">
                        <div class="form-group">
                            <label for="listTitle">Titre</label>
                            <input type="text" id="listTitle" placeholder="Titre de la liste" required>
                        </div>
                        <div class="form-group">
                            <label>Icône</label>
                            <div class="icon-selector">
                                <button type="button" class="icon-btn active" data-icon="list">
                                    <i class="fas fa-list"></i>
                                </button>
                                <button type="button" class="icon-btn" data-icon="home">
                                    <i class="fas fa-home"></i>
                                </button>
                                <button type="button" class="icon-btn" data-icon="briefcase">
                                    <i class="fas fa-briefcase"></i>
                                </button>
                                <button type="button" class="icon-btn" data-icon="shopping-cart">
                                    <i class="fas fa-shopping-cart"></i>
                                </button>
                                <button type="button" class="icon-btn" data-icon="heart">
                                    <i class="fas fa-heart"></i>
                                </button>
                                <button type="button" class="icon-btn" data-icon="book">
                                    <i class="fas fa-book"></i>
                                </button>
                                <button type="button" class="icon-btn" data-icon="graduation-cap">
                                    <i class="fas fa-graduation-cap"></i>
                                </button>
                                <button type="button" class="icon-btn" data-icon="users">
                                    <i class="fas fa-users"></i>
                                </button>
                                <button type="button" class="icon-btn" data-icon="plane">
                                    <i class="fas fa-plane"></i>
                                </button>
                            </div>
                            <input type="hidden" id="listIcon" value="list">
                        </div>
                        <div class="form-group">
                            <label>Couleur</label>
                            <div class="color-selector">
                                <button type="button" class="color-btn active" data-color="#4c6ef5" style="background-color: #4c6ef5;"></button>
                                <button type="button" class="color-btn" data-color="#40c057" style="background-color: #40c057;"></button>
                                <button type="button" class="color-btn" data-color="#fa5252" style="background-color: #fa5252;"></button>
                                <button type="button" class="color-btn" data-color="#fab005" style="background-color: #fab005;"></button>
                                <button type="button" class="color-btn" data-color="#15aabf" style="background-color: #15aabf;"></button>
                                <button type="button" class="color-btn" data-color="#7950f2" style="background-color: #7950f2;"></button>
                            </div>
                            <input type="hidden" id="listColor" value="#4c6ef5">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelListForm">Annuler</button>
                    <button type="button" class="btn btn-primary" id="saveList">Enregistrer</button>
                </div>
            </div>
        </div>
        
        <!-- Panneau de recherche avancée -->
        <div class="search-panel" id="searchPanel">
            <div class="search-panel-header">
                <h3>Recherche avancée</h3>
                <button type="button" class="btn-icon" id="closeSearchPanel">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="search-panel-content">
                <form id="searchForm">
                    <div class="search-form">
                        <div class="form-group">
                            <label for="searchQuery">Mot-clé</label>
                            <input type="text" id="searchQuery" placeholder="Rechercher...">
                        </div>
                        <div class="form-group">
                            <label>Status</label>
                            <div class="checkbox-group">
                                <input type="checkbox" id="searchActive" checked>
                                <label for="searchActive">Actives</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="searchCompleted" checked>
                                <label for="searchCompleted">Terminées</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Priorité</label>
                            <div class="checkbox-group">
                                <input type="checkbox" id="searchLow" checked>
                                <label for="searchLow">Faible</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="searchMedium" checked>
                                <label for="searchMedium">Moyenne</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="searchHigh" checked>
                                <label for="searchHigh">Élevée</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Date d'échéance</label>
                            <div class="date-range">
                                <label for="searchStartDate">De</label>
                                <input type="date" id="searchStartDate">
                                <label for="searchEndDate">À</label>
                                <input type="date" id="searchEndDate">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="searchTag">Tag</label>
                            <input type="text" id="searchTag" placeholder="Filtrer par tag">
                        </div>
                    </div>
                    <div class="search-actions">
                        <button type="button" class="btn btn-secondary" id="resetSearch">Réinitialiser</button>
                        <button type="button" class="btn btn-primary" id="applySearch">Rechercher</button>
                    </div>
                </form>
                <div class="search-results" id="searchResults">
                    <!-- Les résultats de recherche seront affichés ici -->
                </div>
            </div>
        </div>
        
        <!-- Panneau d'aide -->
        <div class="help-panel" id="todoHelpPanel">
            <div class="help-panel-header">
                <h3>Aide - Gestionnaire de tâches</h3>
                <button type="button" class="btn-icon" id="closeTodoHelp">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="help-panel-content">
                <h4>Comment utiliser</h4>
                <ol>
                    <li>Créez différentes listes pour organiser vos tâches</li>
                    <li>Ajoutez des tâches en utilisant le champ en haut de la liste</li>
                    <li>Cliquez sur une tâche pour voir et modifier ses détails</li>
                    <li>Cochez une tâche pour la marquer comme terminée</li>
                </ol>
                
                <h4>Fonctionnalités</h4>
                <ul>
                    <li><strong>Sous-tâches</strong> - Décomposez vos tâches en éléments plus petits et faciles à gérer</li>
                    <li><strong>Dates d'échéance</strong> - Définissez des dates limites pour vos tâches</li>
                    <li><strong>Priorités</strong> - Identifiez les tâches importantes avec des niveaux de priorité</li>
                    <li><strong>Tags</strong> - Organisez vos tâches par catégorie avec des tags personnalisés</li>
                    <li><strong>Rappels</strong> - Configurez des rappels pour ne pas oublier vos tâches importantes</li>
                </ul>
                
                <h4>Raccourcis clavier</h4>
                <ul>
                    <li><kbd>Entrée</kbd> : Ajouter une nouvelle tâche</li>
                    <li><kbd>Ctrl</kbd> + <kbd>F</kbd> : Rechercher des tâches</li>
                    <li><kbd>Échap</kbd> : Fermer les panneaux et dialogues ouverts</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
// S'assurer que le module de plein écran est chargé
(function() {
    function initFullscreen() {
        if (!window.fullscreenManager) {
            import('../../js/fullscreen.js')
            .then(() => {
                if (!window.fullscreenManager && typeof FullscreenManager !== 'undefined') {
                    window.fullscreenManager = new FullscreenManager();
                }
            })
            .catch(error => {
                console.error('Erreur chargement fullscreen.js:', error);
            });
        } else {
            window.fullscreenManager.initFullscreenButtons();
        }
    }
    
    // Exécuter immédiatement si le DOM est déjà chargé, sinon attendre l'événement
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initFullscreen);
    } else {
        initFullscreen();
    }
})();

// Initialiser le gestionnaire de tâches
document.addEventListener('DOMContentLoaded', () => {
    import('../../js/tools/todo.js')
    .then(module => {
        // Exposer le gestionnaire de tâches globalement pour les interactions HTML
        window.TodoManager = module.TodoManager;
        
        // Initialiser le gestionnaire
        if (document.getElementById('todoTool')) {
            module.TodoManager.init();
        }
    })
    .catch(error => {
        console.error('Erreur chargement todo.js:', error);
    });
});
</script>